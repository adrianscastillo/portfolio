class t{constructor(){let t=document.getElementById("cursor-canvas");t&&t.remove(),this.canvas=document.createElement("canvas"),this.canvas.id="cursor-canvas",this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.canvas.style.zIndex="999999",this.canvas.style.pointerEvents="none",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.mouse={x:0,y:0},this.trail=[],this.maxTrailLength=40,this.tooltipTimeout=null,this.showTooltip=!1,this.holdStartTime=null,this.holdProgress=0,this.isHolding=!1,this.init(),this.bindEvents(),this.animate()}init(){this.resize(),window.addEventListener("resize",()=>this.resize()),setTimeout(()=>{if(this.canvas&&this.ctx){this.canvas.style.display="block",this.canvas.style.visibility="visible";const t=this.canvas.getBoundingClientRect();t.width>0&&t.height,document.body.style.cursor="none",this.isInitialized=!0}else this.restoreSystemCursor()},200),document.addEventListener("contextmenu",t=>t.preventDefault()),this.visibilityCheckInterval=setInterval(()=>{this.checkCursorVisibility()},5e3)}resize(){const t=window.devicePixelRatio||1,i=window.innerWidth,e=window.innerHeight;this.canvas.width=i*t,this.canvas.height=e*t,this.ctx.scale(t,t),this.canvas.style.width=i+"px",this.canvas.style.height=e+"px"}bindEvents(){document.addEventListener("mousemove",t=>{this.mouse.x=t.clientX,this.mouse.y=t.clientY,this.trail.push({x:t.clientX,y:t.clientY,time:Date.now()}),this.trail.length>this.maxTrailLength&&this.trail.shift()}),document.addEventListener("mouseleave",()=>{this.trail=[],this.clearTooltip()}),document.addEventListener("mouseover",t=>{t.target.classList.contains("gallery-photo")&&this.startTooltipTimer()}),document.addEventListener("mouseout",t=>{t.target.classList.contains("gallery-photo")&&this.clearTooltip()}),document.addEventListener("mouseover",t=>{t.target.hasAttribute("data-drag-scroll")&&this.clearTooltip()}),document.addEventListener("click",t=>{const i=t.target;"A"===i.tagName||"BUTTON"===i.tagName||i.onclick||"pointer"===i.style.cursor||(this.trail=[])})}getColorAtPosition(t,i){const e=document.elementFromPoint(t,i);if(!e)return"white";if(e.classList.contains("draggable-box")){const t=e.style.backgroundImage;if(t&&"none"!==t)return"black"}if(e.classList.contains("work"))return"black";if(e.classList.contains("scatter"))return"black";if(e.hasAttribute("data-drag-scroll"))return e.getAttribute("data-drag-state"),"black";let s=e,o=0;for(;s&&o<5;){if(s.textContent&&s.textContent.trim()&&"BODY"!==s.tagName&&"HTML"!==s.tagName){const t=window.getComputedStyle(s).color;if(t&&"rgba(0, 0, 0, 0)"!==t&&"transparent"!==t)return t}s=s.parentElement,o++}const n=window.getComputedStyle(e).backgroundColor;if("transparent"===n||"rgba(0, 0, 0, 0)"===n){const t=e.parentElement;if(t){const i=window.getComputedStyle(t).backgroundColor;return this.parseBackgroundColor(i)}}return this.parseBackgroundColor(n)}parseBackgroundColor(t){if(t.startsWith("rgb")){const i=t.match(/\d+/g);if(i&&i.length>=3){const t=parseInt(i[0]),e=parseInt(i[1]),s=parseInt(i[2]);if(t>180&&e>180&&s>180)return"#0002aa"}}return"white"===t||"#ffffff"===t||"#fff"===t?"#0002aa":"white"}drawArrow(t,i,e,s){this.ctx.save();const o=.6*s;this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.beginPath(),"left"===e?(this.ctx.moveTo(t+o/2,i-o/2),this.ctx.lineTo(t-o/2,i),this.ctx.lineTo(t+o/2,i+o/2)):"right"===e&&(this.ctx.moveTo(t-o/2,i-o/2),this.ctx.lineTo(t+o/2,i),this.ctx.lineTo(t-o/2,i+o/2)),this.ctx.lineWidth=4,this.ctx.strokeStyle="white",this.ctx.stroke(),this.ctx.lineWidth=2,this.ctx.strokeStyle="black",this.ctx.stroke(),this.ctx.restore()}drawX(t,i,e){this.ctx.save();const s=.6*e;this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.lineWidth=4,this.ctx.strokeStyle="white",this.ctx.beginPath(),this.ctx.moveTo(t-s/2,i-s/2),this.ctx.lineTo(t+s/2,i+s/2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+s/2,i-s/2),this.ctx.lineTo(t-s/2,i+s/2),this.ctx.stroke(),this.ctx.lineWidth=2,this.ctx.strokeStyle="black",this.ctx.beginPath(),this.ctx.moveTo(t-s/2,i-s/2),this.ctx.lineTo(t+s/2,i+s/2),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t+s/2,i-s/2),this.ctx.lineTo(t-s/2,i+s/2),this.ctx.stroke(),this.ctx.restore()}drawGrabCursor(t,i){this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="black",this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(t,i,8,0,2*Math.PI),this.ctx.stroke(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t-4,i-6),this.ctx.lineTo(t-2,i-8),this.ctx.moveTo(t-1,i-6),this.ctx.lineTo(t+1,i-8),this.ctx.moveTo(t+2,i-6),this.ctx.lineTo(t+4,i-8),this.ctx.stroke(),this.ctx.restore()}drawGrabbingCursor(t,i){this.ctx.save(),this.ctx.lineWidth=2,this.ctx.strokeStyle="black",this.ctx.fillStyle="white",this.ctx.beginPath(),this.ctx.arc(t,i,8,0,2*Math.PI),this.ctx.stroke(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t-6,i-2),this.ctx.lineTo(t+6,i-2),this.ctx.moveTo(t-6,i+2),this.ctx.lineTo(t+6,i+2),this.ctx.stroke(),this.ctx.restore()}drawDragScrollCursor(t,i){this.ctx.save(),this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t,i,8,0,2*Math.PI),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(t-16,i),this.ctx.lineTo(t-12,i-4),this.ctx.lineTo(t-12,i),this.ctx.lineTo(t-12,i+4),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t+16,i),this.ctx.lineTo(t+12,i-4),this.ctx.lineTo(t+12,i),this.ctx.lineTo(t+12,i+4),this.ctx.closePath(),this.ctx.fill(),this.ctx.restore()}drawGalleryImageCursor(t,i){this.ctx.save(),this.ctx.beginPath(),this.ctx.moveTo(t-16,i),this.ctx.lineTo(t-12,i-4),this.ctx.lineTo(t-12,i),this.ctx.lineTo(t-12,i+4),this.ctx.closePath(),this.ctx.fill(),this.ctx.beginPath(),this.ctx.moveTo(t+16,i),this.ctx.lineTo(t+12,i-4),this.ctx.lineTo(t+12,i),this.ctx.lineTo(t+12,i+4),this.ctx.closePath(),this.ctx.fill(),this.isHolding&&this.holdProgress>0?(this.ctx.lineWidth=1,this.ctx.strokeStyle=this.getColorAtPosition(t,i)||"white",this.ctx.beginPath(),this.ctx.arc(t,i,8,-Math.PI/2,-Math.PI/2+this.holdProgress*Math.PI*2),this.ctx.stroke()):(this.ctx.lineWidth=1,this.ctx.beginPath(),this.ctx.arc(t,i,8,0,2*Math.PI),this.ctx.stroke()),this.showTooltip&&this.drawTooltip(t,i),this.ctx.restore()}drawTooltip(t,i){this.ctx.save(),this.ctx.font="12px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillStyle="black";const e=i+25;this.ctx.fillText("hold",t,e),this.ctx.restore()}startTooltipTimer(){this.clearTooltip(),this.tooltipTimeout=setTimeout(()=>{this.showTooltip=!0},1e3)}clearTooltip(){this.tooltipTimeout&&(clearTimeout(this.tooltipTimeout),this.tooltipTimeout=null),this.showTooltip=!1,this.isHolding=!1,this.holdProgress=0,this.holdStartTime=null}startHoldAnimation(){this.isHolding=!0,this.holdStartTime=Date.now(),this.holdProgress=0}updateHoldAnimation(){if(this.isHolding&&this.holdStartTime){const t=Date.now()-this.holdStartTime;this.holdProgress=Math.min(t/500,1),this.holdProgress>=1&&(this.isHolding=!1,this.holdProgress=0,this.holdStartTime=null)}}checkCursorVisibility(){if(!this.canvas||!this.ctx||!this.isInitialized)return void this.restoreSystemCursor();const t=this.canvas.getBoundingClientRect();0!==t.width&&0!==t.height&&document.body.contains(this.canvas)||this.restoreSystemCursor()}restoreSystemCursor(){document.body.style.cursor="auto",document.documentElement.style.cursor="auto",this.visibilityCheckInterval&&clearInterval(this.visibilityCheckInterval),this.isInitialized=!1,setTimeout(()=>{this.isInitialized||this.attemptReinitialization()},2e3)}attemptReinitialization(){try{this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),this.canvas=document.createElement("canvas"),this.canvas.id="cursor-canvas",this.canvas.style.position="fixed",this.canvas.style.top="0",this.canvas.style.left="0",this.canvas.style.width="100vw",this.canvas.style.height="100vh",this.canvas.style.zIndex="100001",this.canvas.style.pointerEvents="none",document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx?(this.init(),this.bindEvents(),this.animate()):document.body.style.cursor="auto"}catch(t){document.body.style.cursor="auto"}}animate(){if(!this.isInitialized||!this.canvas||!this.ctx)return void requestAnimationFrame(()=>this.animate());this.ctx.clearRect(0,0,window.innerWidth,window.innerHeight);const t=document.querySelector(".image-viewer.active"),i=document.elementFromPoint(this.mouse.x,this.mouse.y),e=t&&i&&(i===t||t.contains(i)),s=document.getElementById("viewerImage"),o=t&&i===s,n=t&&t.classList.contains("cursor-left"),c=t&&t.classList.contains("cursor-right"),r=e&&o&&(n||c),h=e&&!o;if(this.trail.length>1&&!r&&!h){this.ctx.save(),this.ctx.lineWidth=1,this.ctx.lineCap="round",this.ctx.lineJoin="round",this.ctx.globalAlpha=1;for(let t=1;t<this.trail.length;t++){const i=this.trail[t-1],e=this.trail[t],s=(i.x+e.x)/2,o=(i.y+e.y)/2,n=this.getColorAtPosition(s,o);this.ctx.strokeStyle=n,this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y),this.ctx.lineTo(e.x,e.y),this.ctx.stroke()}this.ctx.restore()}const a=this.getColorAtPosition(this.mouse.x,this.mouse.y)||"white",l=i&&["A","BUTTON","INPUT","TEXTAREA","SELECT","LABEL","SUMMARY"].includes(i.tagName),d=i&&i.getAttribute&&i.getAttribute("role"),u=d&&["button","link","tab","switch","checkbox","radio","menuitem"].includes(d),m=i?window.getComputedStyle(i).cursor:"",x=!(!i||!(l||u||i.onclick||"pointer"===m)),v=i&&i.hasAttribute("data-drag-scroll");v&&i.getAttribute("data-drag-state");const y=i&&i.classList.contains("gallery-photo");if(this.ctx.save(),this.ctx.strokeStyle=a,this.ctx.fillStyle=a,this.ctx.lineWidth=1,this.ctx.font="16px Arial",this.ctx.textAlign="center",this.ctx.textBaseline="middle",r){const t=24;n?this.drawArrow(this.mouse.x,this.mouse.y,"left",t):c&&this.drawArrow(this.mouse.x,this.mouse.y,"right",t)}else if(h){const t=24;this.drawX(this.mouse.x,this.mouse.y,t)}else v?this.drawDragScrollCursor(this.mouse.x,this.mouse.y):y?this.drawGalleryImageCursor(this.mouse.x,this.mouse.y):x?(this.ctx.beginPath(),this.ctx.arc(this.mouse.x,this.mouse.y,8,0,2*Math.PI),this.ctx.stroke()):(this.ctx.beginPath(),this.ctx.arc(this.mouse.x,this.mouse.y,3,0,2*Math.PI),this.ctx.fill());this.ctx.restore(),this.updateHoldAnimation(),requestAnimationFrame(()=>this.animate())}destroy(){this.visibilityCheckInterval&&clearInterval(this.visibilityCheckInterval),this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas),document.body.style.cursor="auto",document.documentElement.style.cursor="auto",this.isInitialized=!1}}function i(){if(window.cursorInitializationAttempted)return;window.cursorInitializationAttempted=!0;let i=0;!function e(){i++;try{if(function(){try{if("undefined"==typeof window||"undefined"==typeof document)return;if("ontouchstart"in window||navigator.maxTouchPoints>0||window.matchMedia("(pointer: coarse)").matches)return document.body.style.cursor="auto",void(document.documentElement.style.cursor="auto");const i=document.createElement("canvas");if(!i.getContext||!i.getContext("2d"))return document.body.style.cursor="auto",void(document.documentElement.style.cursor="auto");window.customCursor=new t}catch(i){document.body.style.cursor="auto",document.documentElement.style.cursor="auto";const t=document.createElement("style");t.id="cursor-fallback",t.textContent="\n      * { cursor: auto !important; }\n      body { cursor: auto !important; }\n      html { cursor: auto !important; }\n      a, button, input, textarea, select, label, summary { cursor: pointer !important; }\n    ",document.head.appendChild(t),document.body.style.cursor="auto",document.documentElement.style.cursor="auto",window.restoreCursor=function(){document.body.style.cursor="auto",document.documentElement.style.cursor="auto",window.customCursor&&(window.customCursor.destroy(),window.customCursor=null)};const e=()=>{"none"!==document.body.style.cursor||window.customCursor||(document.body.style.cursor="auto",document.documentElement.style.cursor="auto")};document.addEventListener("mousemove",e,{once:!0}),document.addEventListener("click",e,{once:!0}),document.addEventListener("keydown",e,{once:!0})}}(),window.customCursor)return}catch(s){}i<3?setTimeout(e,100*i):(document.body.style.cursor="auto",document.documentElement.style.cursor="auto")}()}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i(),setTimeout(()=>{window.customCursor||window.cursorInitializationAttempted||i()},500);let e=null;setTimeout(function(){e||(e=setInterval(()=>{"none"!==document.body.style.cursor||window.customCursor&&window.customCursor.isInitialized||(document.body.style.cursor="auto",document.documentElement.style.cursor="auto",window.customCursor||setTimeout(()=>{window.customCursor||i()},1e3))},2e3))},3e3),window.addEventListener("beforeunload",()=>{e&&clearInterval(e)});
